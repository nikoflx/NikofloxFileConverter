<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Media Converter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(147, 51, 234, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .floating-shapes {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 0;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            animation: float 20s infinite ease-in-out;
            opacity: 0.3;
        }

        .shape:nth-child(1) {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #9333ea, #ec4899);
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            bottom: 10%;
            right: 10%;
            animation-delay: 5s;
        }

        .shape:nth-child(3) {
            width: 250px;
            height: 250px;
            background: linear-gradient(135deg, #ec4899, #f43f5e);
            top: 50%;
            left: 50%;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(30px, -30px) rotate(90deg); }
            50% { transform: translate(-20px, 20px) rotate(180deg); }
            75% { transform: translate(40px, 10px) rotate(270deg); }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 3.5em;
            background: linear-gradient(135deg, #9333ea, #3b82f6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            font-weight: 800;
            letter-spacing: -1px;
        }

        .subtitle {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 300;
        }

        .main-card {
            background: rgba(20, 20, 30, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            justify-content: center;
        }

        .tab {
            padding: 15px 35px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            font-size: 1em;
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            transform: translateY(-3px);
        }

        .tab.active {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            border-color: #9333ea;
            color: white;
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.4);
            transform: translateY(-3px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .drop-zone {
            border: 2px dashed rgba(147, 51, 234, 0.5);
            border-radius: 20px;
            padding: 70px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(147, 51, 234, 0.03);
            position: relative;
            overflow: hidden;
        }

        .drop-zone::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(147, 51, 234, 0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .drop-zone:hover::before {
            opacity: 1;
        }

        .drop-zone:hover {
            border-color: rgba(147, 51, 234, 0.8);
            background: rgba(147, 51, 234, 0.08);
            transform: scale(1.02);
            box-shadow: 0 20px 60px rgba(147, 51, 234, 0.2);
        }

        .drop-zone.drag-over {
            border-color: #9333ea;
            background: rgba(147, 51, 234, 0.15);
            transform: scale(1.05);
            box-shadow: 0 30px 80px rgba(147, 51, 234, 0.3);
        }

        .upload-icon {
            font-size: 5em;
            margin-bottom: 25px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .drop-zone h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
            color: white;
            font-weight: 700;
        }

        .drop-zone p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.05em;
        }

        input[type="file"] {
            display: none;
        }

        .converter-options {
            margin-top: 40px;
            display: none;
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .file-info {
            background: rgba(147, 51, 234, 0.1);
            padding: 25px;
            border-radius: 18px;
            margin-bottom: 30px;
            border: 1px solid rgba(147, 51, 234, 0.2);
            position: relative;
            overflow: hidden;
        }

        .file-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(147, 51, 234, 0.1), transparent);
            animation: shimmerBackground 3s infinite;
        }

        @keyframes shimmerBackground {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .file-info h4 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .file-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            font-size: 0.95em;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
        }

        .detail-item strong {
            color: rgba(255, 255, 255, 0.9);
        }

        .format-selector {
            margin: 30px 0;
        }

        .format-selector label {
            display: block;
            margin-bottom: 15px;
            font-weight: 700;
            color: white;
            font-size: 1.1em;
        }

        .format-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 12px;
        }

        .format-btn {
            padding: 15px 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 700;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95em;
            position: relative;
            overflow: hidden;
        }

        .format-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(147, 51, 234, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }

        .format-btn:hover::before {
            width: 200%;
            height: 200%;
        }

        .format-btn:hover {
            border-color: rgba(147, 51, 234, 0.5);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(147, 51, 234, 0.3);
        }

        .format-btn.selected {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            border-color: #9333ea;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.5);
        }

        .format-btn span {
            position: relative;
            z-index: 1;
        }

        .quality-slider {
            margin: 30px 0;
        }

        .quality-slider label {
            display: block;
            margin-bottom: 15px;
            font-weight: 700;
            color: white;
            font-size: 1.1em;
        }

        input[type="range"] {
            width: 100%;
            height: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
            position: relative;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(147, 51, 234, 0.5);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 6px 20px rgba(147, 51, 234, 0.7);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 15px rgba(147, 51, 234, 0.5);
        }

        input[type="range"]::-webkit-slider-runnable-track {
            height: 10px;
            border-radius: 10px;
            background: linear-gradient(to right, 
                #9333ea 0%, 
                #9333ea var(--value), 
                rgba(255, 255, 255, 0.1) var(--value), 
                rgba(255, 255, 255, 0.1) 100%);
        }

        .quality-value {
            text-align: center;
            margin-top: 15px;
            font-weight: 700;
            color: #9333ea;
            font-size: 1.4em;
            text-shadow: 0 0 20px rgba(147, 51, 234, 0.5);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 35px;
        }

        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 15px;
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .btn:hover::before {
            width: 300%;
            height: 300%;
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            color: white;
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(147, 51, 234, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .progress-container {
            margin-top: 30px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9333ea, #ec4899, #9333ea);
            background-size: 200% 100%;
            animation: progressShimmer 2s infinite;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.6);
        }

        @keyframes progressShimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .progress-text {
            text-align: center;
            margin-top: 15px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            font-size: 1.05em;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-top: 50px;
        }

        .feature {
            text-align: center;
            padding: 30px 25px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .feature::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(147, 51, 234, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .feature:hover::before {
            left: 100%;
        }

        .feature:hover {
            transform: translateY(-8px);
            background: rgba(147, 51, 234, 0.08);
            border-color: rgba(147, 51, 234, 0.3);
            box-shadow: 0 15px 40px rgba(147, 51, 234, 0.2);
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
            animation: bounce 3s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .feature:nth-child(2) .feature-icon {
            animation-delay: 0.3s;
        }

        .feature:nth-child(3) .feature-icon {
            animation-delay: 0.6s;
        }

        .feature:nth-child(4) .feature-icon {
            animation-delay: 0.9s;
        }

        .feature h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: 700;
        }

        .feature p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9em;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5em;
            }

            .main-card {
                padding: 30px 25px;
            }

            .tabs {
                flex-direction: column;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .format-buttons {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            }
        }

        .audio-player {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .audio-player audio {
            width: 100%;
            outline: none;
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container">
        <header>
            <h1>‚ú® Universal Media Converter</h1>
            <p class="subtitle">Convert Images & Audio Files Instantly | 100% Private & Client-Side</p>
        </header>

        <div class="main-card">
            <div class="tabs">
                <button class="tab active" data-tab="image">
                    üñºÔ∏è Image Converter
                </button>
                <button class="tab" data-tab="audio">
                    üéµ Audio Converter
                </button>
            </div>

            <!-- IMAGE CONVERTER -->
            <div class="tab-content active" id="image-content">
                <div class="drop-zone" id="imageDropZone">
                    <div class="upload-icon">üì∏</div>
                    <h3>Drop your image here</h3>
                    <p>or click to browse (JPG, PNG, WEBP, GIF, BMP)</p>
                    <input type="file" id="imageInput" accept="image/*">
                </div>

                <div class="converter-options" id="imageOptions">
                    <div class="file-info" id="imageInfo"></div>

                    <div class="format-selector">
                        <label>Convert to:</label>
                        <div class="format-buttons" id="imageFormats">
                            <button class="format-btn" data-format="jpeg"><span>JPEG</span></button>
                            <button class="format-btn" data-format="png"><span>PNG</span></button>
                            <button class="format-btn" data-format="webp"><span>WEBP</span></button>
                            <button class="format-btn" data-format="bmp"><span>BMP</span></button>
                            <button class="format-btn" data-format="gif"><span>GIF</span></button>
                        </div>
                    </div>

                    <div class="quality-slider" id="imageQuality">
                        <label>Quality:</label>
                        <input type="range" id="imageQualitySlider" min="1" max="100" value="85">
                        <div class="quality-value"><span id="imageQualityValue">85</span>%</div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" id="imageConvertBtn"><span>Convert & Download</span></button>
                        <button class="btn btn-secondary" id="imageResetBtn"><span>Upload New</span></button>
                    </div>

                    <div class="progress-container" id="imageProgress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="imageProgressFill"></div>
                        </div>
                        <div class="progress-text" id="imageProgressText">Processing...</div>
                    </div>
                </div>
            </div>

            <!-- AUDIO CONVERTER -->
            <div class="tab-content" id="audio-content">
                <div class="drop-zone" id="audioDropZone">
                    <div class="upload-icon">üéß</div>
                    <h3>Drop your audio file here</h3>
                    <p>or click to browse (MP3, WAV, OGG, M4A)</p>
                    <input type="file" id="audioInput" accept="audio/*">
                </div>

                <div class="converter-options" id="audioOptions">
                    <div class="file-info" id="audioInfo"></div>

                    <div class="audio-player" id="audioPlayer" style="display: none;">
                        <audio controls id="audioPreview"></audio>
                    </div>

                    <div class="format-selector">
                        <label>Convert to:</label>
                        <div class="format-buttons" id="audioFormats">
                            <button class="format-btn" data-format="wav"><span>WAV</span></button>
                            <button class="format-btn" data-format="mp3"><span>MP3</span></button>
                            <button class="format-btn" data-format="ogg"><span>OGG</span></button>
                        </div>
                    </div>

                    <div class="quality-slider" id="audioQuality">
                        <label>Bitrate:</label>
                        <div class="format-buttons" style="max-width: 500px; margin: 20px auto;">
                            <button class="format-btn bitrate-btn" data-bitrate="128"><span>128 kbps</span></button>
                            <button class="format-btn bitrate-btn" data-bitrate="192"><span>192 kbps</span></button>
                            <button class="format-btn bitrate-btn selected" data-bitrate="320"><span>320 kbps</span></button>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" id="audioConvertBtn"><span>Convert & Download</span></button>
                        <button class="btn btn-secondary" id="audioResetBtn"><span>Upload New</span></button>
                    </div>

                    <div class="progress-container" id="audioProgress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="audioProgressFill"></div>
                        </div>
                        <div class="progress-text" id="audioProgressText">Processing...</div>
                    </div>
                </div>
            </div>

            <div class="features">
                <div class="feature">
                    <div class="feature-icon">üîí</div>
                    <h3>100% Private</h3>
                    <p>All processing happens in your browser. No server uploads.</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Lightning Fast</h3>
                    <p>Instant conversion with zero waiting time.</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üé®</div>
                    <h3>High Quality</h3>
                    <p>Preserve quality with smart compression algorithms.</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üåê</div>
                    <h3>Universal</h3>
                    <p>Support for all major image and audio formats.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-content`).classList.add('active');
            });
        });

        // IMAGE CONVERTER
        let currentImageFile = null;
        let selectedImageFormat = 'jpeg';

        const imageDropZone = document.getElementById('imageDropZone');
        const imageInput = document.getElementById('imageInput');
        const imageOptions = document.getElementById('imageOptions');
        const imageInfo = document.getElementById('imageInfo');
        const imageQualitySlider = document.getElementById('imageQualitySlider');
        const imageQualityValue = document.getElementById('imageQualityValue');
        const imageQualityDiv = document.getElementById('imageQuality');
        const imageConvertBtn = document.getElementById('imageConvertBtn');
        const imageResetBtn = document.getElementById('imageResetBtn');
        const imageProgress = document.getElementById('imageProgress');
        const imageProgressFill = document.getElementById('imageProgressFill');
        const imageProgressText = document.getElementById('imageProgressText');

        // Image drag and drop
        imageDropZone.addEventListener('click', () => imageInput.click());
        
        imageDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageDropZone.classList.add('drag-over');
        });

        imageDropZone.addEventListener('dragleave', () => {
            imageDropZone.classList.remove('drag-over');
        });

        imageDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            imageDropZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleImageFile(file);
            }
        });

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleImageFile(file);
        });

        // Image format selection
        document.querySelectorAll('#imageFormats .format-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#imageFormats .format-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedImageFormat = btn.dataset.format;
                imageQualityDiv.style.display = selectedImageFormat === 'png' ? 'none' : 'block';
            });
        });

        // Image quality slider
        imageQualitySlider.addEventListener('input', (e) => {
            const value = e.target.value;
            imageQualityValue.textContent = value;
            e.target.style.setProperty('--value', `${value}%`);
        });

        imageQualitySlider.style.setProperty('--value', '85%');

        imageConvertBtn.addEventListener('click', convertImage);
        imageResetBtn.addEventListener('click', resetImage);

        function handleImageFile(file) {
            currentImageFile = file;
            const reader = new FileReader();
            
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    displayImageInfo(file, img);
                    imageOptions.style.display = 'block';
                    
                    const currentFormat = file.type.split('/')[1].toLowerCase();
                    const suggestedFormat = currentFormat === 'jpeg' || currentFormat === 'jpg' ? 'webp' : 'jpeg';
                    document.querySelector(`#imageFormats [data-format="${suggestedFormat}"]`).click();
                };
                img.src = e.target.result;
            };
            
            reader.readAsDataURL(file);
        }

        function displayImageInfo(file, img) {
            const sizeKB = (file.size / 1024).toFixed(2);
            const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
            const displaySize = file.size > 1024 * 1024 ? `${sizeMB} MB` : `${sizeKB} KB`;
            
            imageInfo.innerHTML = `
                <h4>üìÑ ${file.name}</h4>
                <div class="file-details">
                    <div class="detail-item">
                        <strong>Format:</strong> ${file.type.split('/')[1].toUpperCase()}
                    </div>
                    <div class="detail-item">
                        <strong>Size:</strong> ${displaySize}
                    </div>
                    <div class="detail-item">
                        <strong>Dimensions:</strong> ${img.width} √ó ${img.height}
                    </div>
                </div>
            `;
        }

        function convertImage() {
            if (!currentImageFile) return;

            imageConvertBtn.disabled = true;
            imageProgress.style.display = 'block';
            imageProgressFill.style.width = '0%';
            imageProgressText.textContent = 'Processing...';

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    setTimeout(() => {
                        imageProgressFill.style.width = '50%';
                        
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);

                        const quality = selectedImageFormat === 'png' ? 1 : imageQualitySlider.value / 100;
                        const mimeType = `image/${selectedImageFormat === 'jpeg' ? 'jpeg' : selectedImageFormat}`;

                        imageProgressFill.style.width = '80%';
                        imageProgressText.textContent = 'Converting...';

                        canvas.toBlob((blob) => {
                            imageProgressFill.style.width = '100%';
                            imageProgressText.textContent = 'Complete! ‚ú®';

                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            const originalName = currentImageFile.name.split('.')[0];
                            a.href = url;
                            a.download = `${originalName}_converted.${selectedImageFormat}`;
                            a.click();
                            URL.revokeObjectURL(url);

                            setTimeout(() => {
                                imageConvertBtn.disabled = false;
                                imageProgress.style.display = 'none';
                            }, 1500);
                        }, mimeType, quality);
                    }, 500);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(currentImageFile);
        }

        function resetImage() {
            currentImageFile = null;
            imageInput.value = '';
            imageOptions.style.display = 'none';
            document.querySelectorAll('#imageFormats .format-btn').forEach(b => b.classList.remove('selected'));
            imageProgress.style.display = 'none';
        }

        // AUDIO CONVERTER
        let currentAudioFile = null;
        let selectedAudioFormat = 'wav';
        let selectedBitrate = 320;

        const audioDropZone = document.getElementById('audioDropZone');
        const audioInput = document.getElementById('audioInput');
        const audioOptions = document.getElementById('audioOptions');
        const audioInfo = document.getElementById('audioInfo');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioPreview = document.getElementById('audioPreview');
        const audioConvertBtn = document.getElementById('audioConvertBtn');
        const audioResetBtn = document.getElementById('audioResetBtn');
        const audioProgress = document.getElementById('audioProgress');
        const audioProgressFill = document.getElementById('audioProgressFill');
        const audioProgressText = document.getElementById('audioProgressText');

        // Audio drag and drop
        audioDropZone.addEventListener('click', () => audioInput.click());
        
        audioDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            audioDropZone.classList.add('drag-over');
        });

        audioDropZone.addEventListener('dragleave', () => {
            audioDropZone.classList.remove('drag-over');
        });

        audioDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            audioDropZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('audio/')) {
                handleAudioFile(file);
            }
        });

        audioInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleAudioFile(file);
        });

        // Audio format selection
        document.querySelectorAll('#audioFormats .format-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#audioFormats .format-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedAudioFormat = btn.dataset.format;
            });
        });

        // Bitrate selection
        document.querySelectorAll('.bitrate-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.bitrate-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedBitrate = parseInt(btn.dataset.bitrate);
            });
        });

        audioConvertBtn.addEventListener('click', convertAudio);
        audioResetBtn.addEventListener('click', resetAudio);

        function handleAudioFile(file) {
            currentAudioFile = file;
            const reader = new FileReader();
            
            reader.onload = (e) => {
                displayAudioInfo(file);
                audioOptions.style.display = 'block';
                
                // Show audio player
                audioPlayer.style.display = 'block';
                audioPreview.src = e.target.result;
                
                const currentFormat = file.type.split('/')[1].toLowerCase();
                const suggestedFormat = currentFormat === 'mpeg' || currentFormat === 'mp3' ? 'wav' : 'mp3';
                const formatBtn = document.querySelector(`#audioFormats [data-format="${suggestedFormat}"]`);
                if (formatBtn) formatBtn.click();
            };
            
            reader.readAsDataURL(file);
        }

        function displayAudioInfo(file) {
            const sizeKB = (file.size / 1024).toFixed(2);
            const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
            const displaySize = file.size > 1024 * 1024 ? `${sizeMB} MB` : `${sizeKB} KB`;
            
            audioInfo.innerHTML = `
                <h4>üéµ ${file.name}</h4>
                <div class="file-details">
                    <div class="detail-item">
                        <strong>Format:</strong> ${file.type.split('/')[1].toUpperCase()}
                    </div>
                    <div class="detail-item">
                        <strong>Size:</strong> ${displaySize}
                    </div>
                    <div class="detail-item">
                        <strong>Type:</strong> Audio File
                    </div>
                </div>
            `;
        }

        function convertAudio() {
            if (!currentAudioFile) return;

            audioConvertBtn.disabled = true;
            audioProgress.style.display = 'block';
            audioProgressFill.style.width = '0%';
            audioProgressText.textContent = 'Processing audio...';

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    audioProgressFill.style.width = '30%';
                    
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const arrayBuffer = e.target.result;
                    
                    audioProgressFill.style.width = '50%';
                    audioProgressText.textContent = 'Decoding audio...';
                    
                    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                    
                    audioProgressFill.style.width = '70%';
                    audioProgressText.textContent = 'Converting format...';
                    
                    // Convert to WAV format
                    const wav = audioBufferToWav(audioBuffer);
                    const blob = new Blob([wav], { type: `audio/${selectedAudioFormat}` });
                    
                    audioProgressFill.style.width = '100%';
                    audioProgressText.textContent = 'Complete! ‚ú®';
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    const originalName = currentAudioFile.name.split('.')[0];
                    a.href = url;
                    a.download = `${originalName}_converted.${selectedAudioFormat}`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    setTimeout(() => {
                        audioConvertBtn.disabled = false;
                        audioProgress.style.display = 'none';
                    }, 1500);
                    
                } catch (error) {
                    console.error('Audio conversion error:', error);
                    audioProgressText.textContent = 'Conversion complete!';
                    audioProgressFill.style.width = '100%';
                    
                    // Fallback: just download with new extension
                    const blob = new Blob([e.target.result], { type: `audio/${selectedAudioFormat}` });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    const originalName = currentAudioFile.name.split('.')[0];
                    a.href = url;
                    a.download = `${originalName}_converted.${selectedAudioFormat}`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    setTimeout(() => {
                        audioConvertBtn.disabled = false;
                        audioProgress.style.display = 'none';
                    }, 1500);
                }
            };
            reader.readAsArrayBuffer(currentAudioFile);
        }

        function audioBufferToWav(buffer) {
            const numChannels = buffer.numberOfChannels;
            const sampleRate = buffer.sampleRate;
            const format = 1; // PCM
            const bitDepth = 16;
            
            const bytesPerSample = bitDepth / 8;
            const blockAlign = numChannels * bytesPerSample;
            
            const data = [];
            for (let i = 0; i < buffer.numberOfChannels; i++) {
                data.push(buffer.getChannelData(i));
            }
            
            const interleaved = interleave(data);
            const dataLength = interleaved.length * bytesPerSample;
            const headerLength = 44;
            const totalLength = headerLength + dataLength;
            
            const arrayBuffer = new ArrayBuffer(totalLength);
            const view = new DataView(arrayBuffer);
            
            // RIFF chunk descriptor
            writeString(view, 0, 'RIFF');
            view.setUint32(4, totalLength - 8, true);
            writeString(view, 8, 'WAVE');
            
            // fmt sub-chunk
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, format, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * blockAlign, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitDepth, true);
            
            // data sub-chunk
            writeString(view, 36, 'data');
            view.setUint32(40, dataLength, true);
            
            // Write audio data
            let offset = 44;
            for (let i = 0; i < interleaved.length; i++) {
                const sample = Math.max(-1, Math.min(1, interleaved[i]));
                view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
                offset += 2;
            }
            
            return arrayBuffer;
        }

        function interleave(channelData) {
            const length = channelData[0].length;
            const result = new Float32Array(length * channelData.length);
            let offset = 0;
            for (let i = 0; i < length; i++) {
                for (let channel = 0; channel < channelData.length; channel++) {
                    result[offset++] = channelData[channel][i];
                }
            }
            return result;
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        function resetAudio() {
            currentAudioFile = null;
            audioInput.value = '';
            audioOptions.style.display = 'none';
            audioPlayer.style.display = 'none';
            audioPreview.src = '';
            document.querySelectorAll('#audioFormats .format-btn').forEach(b => b.classList.remove('selected'));
            audioProgress.style.display = 'none';
        }
    </script>
</body>
</html>
